<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paystack Setup - Church Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h3 class="mb-0">
                            <i class="bi bi-credit-card me-2"></i>
                            Paystack Integration Setup
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            <strong>Setup Guide:</strong> Follow these steps to integrate Paystack for automatic MoMo payments to instrumentalists.
                        </div>

                        <!-- Step 1: Paystack Account -->
                        <div class="mb-4">
                            <h5 class="text-primary">
                                <i class="bi bi-1-circle me-2"></i>Create Paystack Account
                            </h5>
                            <p>If you don't have a Paystack account:</p>
                            <ol>
                                <li>Visit <a href="https://paystack.com" target="_blank">paystack.com</a></li>
                                <li>Click "Get Started" and create your business account</li>
                                <li>Complete the verification process</li>
                                <li>Enable transfers in your Paystack dashboard</li>
                            </ol>
                        </div>

                        <!-- Step 2: API Keys -->
                        <div class="mb-4">
                            <h5 class="text-primary">
                                <i class="bi bi-2-circle me-2"></i>Get API Keys
                            </h5>
                            <p>From your Paystack dashboard:</p>
                            <ol>
                                <li>Go to Settings → API Keys & Webhooks</li>
                                <li>Copy your <strong>Secret Key</strong> (starts with sk_test_ or sk_live_)</li>
                                <li>Copy your <strong>Public Key</strong> (starts with pk_test_ or pk_live_)</li>
                            </ol>
                            
                            <div class="alert alert-warning">
                                <i class="bi bi-exclamation-triangle me-2"></i>
                                <strong>Important:</strong> Use test keys for testing and live keys for production.
                            </div>
                        </div>

                        <!-- Step 3: Configure Keys -->
                        <div class="mb-4">
                            <h5 class="text-primary">
                                <i class="bi bi-3-circle me-2"></i>Configure API Keys
                            </h5>
                            <p>Update the keys in <code>config/paystack.php</code>:</p>
                            
                            <div class="bg-success text-light p-3 rounded">
                                <code>
✅ Keys Configured Successfully!<br>
define('PAYSTACK_SECRET_KEY', 'sk_test_64b8...134'); // ✅ Configured<br>
define('PAYSTACK_PUBLIC_KEY', 'pk_test_d750...f95'); // ✅ Configured
                                </code>
                            </div>
                            <div class="alert alert-success mt-2">
                                <i class="bi bi-check-circle me-2"></i>
                                <strong>Keys Configured:</strong> Your Paystack test keys are properly configured and ready for use.
                            </div>
                        </div>

                        <!-- Step 4: Test Configuration -->
                        <div class="mb-4">
                            <h5 class="text-primary">
                                <i class="bi bi-4-circle me-2"></i>Test Configuration
                            </h5>
                            <p>Test your Paystack integration:</p>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <button class="btn btn-outline-primary w-100 mb-2" onclick="testPaystackConnection()">
                                        <i class="bi bi-wifi me-2"></i>Test Connection
                                    </button>
                                </div>
                                <div class="col-md-6">
                                    <button class="btn btn-outline-success w-100 mb-2" onclick="checkPaystackBalance()">
                                        <i class="bi bi-wallet2 me-2"></i>Check Balance
                                    </button>
                                </div>
                            </div>
                            
                            <div id="test-results" class="mt-3"></div>
                        </div>

                        <!-- Step 5: Usage Instructions -->
                        <div class="mb-4">
                            <h5 class="text-primary">
                                <i class="bi bi-5-circle me-2"></i>How to Use
                            </h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>For Instrumentalists:</h6>
                                    <ul>
                                        <li>Add instrumentalists with complete MoMo details</li>
                                        <li>Include MoMo provider, number, and account name</li>
                                        <li>System will create Paystack recipients automatically</li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <h6>For Payments:</h6>
                                    <ul>
                                        <li>Create and approve payments as usual</li>
                                        <li>Choose "Paystack MoMo Transfer" when processing</li>
                                        <li>Payments are sent directly to instrumentalist's MoMo</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Supported MoMo Providers -->
                        <div class="mb-4">
                            <h5 class="text-primary">
                                <i class="bi bi-phone me-2"></i>Supported MoMo Providers
                            </h5>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="text-center p-3 border rounded">
                                        <i class="bi bi-phone-fill text-warning fs-2"></i>
                                        <div class="mt-2"><strong>MTN MoMo</strong></div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center p-3 border rounded">
                                        <i class="bi bi-phone-fill text-danger fs-2"></i>
                                        <div class="mt-2"><strong>Vodafone Cash</strong></div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center p-3 border rounded">
                                        <i class="bi bi-phone-fill text-primary fs-2"></i>
                                        <div class="mt-2"><strong>AirtelTigo Money</strong></div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center p-3 border rounded">
                                        <i class="bi bi-phone-fill text-secondary fs-2"></i>
                                        <div class="mt-2"><strong>Other Providers</strong></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Security Notes -->
                        <div class="alert alert-danger">
                            <h6><i class="bi bi-shield-exclamation me-2"></i>Security Important:</h6>
                            <ul class="mb-0">
                                <li>Never share your secret keys publicly</li>
                                <li>Use test keys for development and testing</li>
                                <li>Switch to live keys only for production</li>
                                <li>Regularly monitor your Paystack dashboard</li>
                            </ul>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="d-flex justify-content-between">
                            <a href="index.php" class="btn btn-secondary">
                                <i class="bi bi-arrow-left me-2"></i>Back to Dashboard
                            </a>
                            <a href="https://paystack.com/docs/transfers/single-transfers" target="_blank" class="btn btn-outline-primary">
                                <i class="bi bi-book me-2"></i>Paystack Documentation
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function showResult(message, type = 'info') {
            const resultsDiv = document.getElementById('test-results');
            const alertClass = type === 'success' ? 'alert-success' : type === 'error' ? 'alert-danger' : 'alert-info';
            
            resultsDiv.innerHTML += `
                <div class="alert ${alertClass} alert-dismissible fade show">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
        }

        async function testPaystackConnection() {
            showResult('Testing Paystack connection...', 'info');
            
            try {
                const response = await fetch('api/paystack_payments.php?action=balance');
                const result = await response.json();
                
                if (result.success) {
                    showResult(`✅ Connection successful! Balance: ${result.formatted_balance}`, 'success');
                } else {
                    showResult(`❌ Connection failed: ${result.error}`, 'error');
                }
            } catch (error) {
                showResult(`❌ Connection error: ${error.message}`, 'error');
            }
        }

        async function checkPaystackBalance() {
            showResult('Checking Paystack balance...', 'info');
            
            try {
                const response = await fetch('api/paystack_payments.php?action=balance');
                const result = await response.json();
                
                if (result.success) {
                    showResult(`💰 Current balance: ${result.formatted_balance}`, 'success');
                } else {
                    showResult(`❌ Failed to get balance: ${result.error}`, 'error');
                }
            } catch (error) {
                showResult(`❌ Balance check error: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
